let o=Number(document.querySelector(".auth").id),f=document.querySelector(".cs"),i=f.querySelector("input"),s=document.querySelector(".kj"),c=document.querySelector("#search");c.addEventListener("keyup",()=>{document.querySelector(".searched").style.display="block";let r={text:c.value};m(),c.value.length===0?s.innerHTML="":(document.querySelector(".loader").style.display="block",fetch("/searchresult",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i.value},body:JSON.stringify(r)}).then(l=>l.json()).then(l=>{console.log(l),document.querySelector(".loader").style.display="none",s.innerHTML="",l.users.forEach(e=>{let t="",d="",n="",y=l.owner.find(a=>{if(e.id==a)return t=3});console.log(y),l.request.find(function(a){if(e.id===a.for_id&&a.from_id==o)return d=a.id,t=1;if(e.id===a.from_id&&a.for_id==o)return d=a.id,t=2}),t==1?n=`<p class="af  c-red can-req" id=${d} un=${e.id}>Cancel Request <div class="lader" id="loader-1"></div></p>`:t==2?n=`<p class="af c-blue acp-request" id=${e.id} un=${d}>Accept Request <div class="lader" id="loader-1"></div></p>`:t==3?n=`<p class="af" id=${e.id}><a href="/chat/${e.id}" style="text-decoration:none;">Message</a> <div class="lader" id="loader-1"></div></p>`:n=`<p class="af tgn" id=${e.id}>Add Friend <div class="lader" id="loader-1"></div></p>`;let p=`<li class="hup">
      <div class="d-flex bd-highlight">
        
        <div class="us_fo">
          <span>${e.first_name+" "+e.second_name}</span>
          <p>Kalid is online</p>
        
          <div class="lk">`+n+`</div>
        </div>
      </div>

    </li>`;s.innerHTML+=p,h(),S(),u()})}))});function h(){document.querySelectorAll(".tgn").forEach(l=>{let e="";l.addEventListener("click",()=>{if(e!=="sent"){let t=l.parentElement;t.querySelector(".lader").style.display="block";let d={num:l.id};l.style.display="none",fetch("/Res",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i.value},body:JSON.stringify(d)}).then(n=>n.json()).then(n=>{t.querySelector(".lader").style.display="none",l.style.display="block",l.innerHTML="Request Sent",l.className="sen",e="sent"})}})})}function m(){document.querySelector(".close").addEventListener("click",()=>{document.querySelector(".close").parentElement.style.display="none"})}function S(r){document.querySelectorAll(".can-req").forEach(e=>{e.addEventListener("click",()=>{let t=e.parentElement;t.querySelector(".lader").style.display="block";let d={num:e.id};fetch("/cancel",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i.value},body:JSON.stringify(d)}).then(n=>n.json()).then(n=>{t.querySelector(".lader").style.display="none",e.style.display="block",e.innerHTML="Request Cancelled",e.className="sen"})})})}function u(r){document.querySelectorAll(".acp-request").forEach(e=>{e.addEventListener("click",()=>{let t=e.parentElement;t.querySelector(".lader").style.display="block";let d={user_id:Number(e.id),data_id:Number(e.getAttribute("un"))};fetch("/accept",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":i.value},body:JSON.stringify(d)}).then(n=>n.json()).then(n=>{t.querySelector(".lader").style.display="none",t.querySelector(".af").remove(),t.innerHTML+=` <p class="af"> <a href="/chat/${d.user_id}" style="text-decoration:none;">Message</a></p>`})})})}u();
